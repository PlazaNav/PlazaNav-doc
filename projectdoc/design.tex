
\section{Design}
\label{sec:Design}
% Die Architektur soll eine objektorientierte Problemdomain umfassen. Eine allfällig eingesetzte Datenbank darf diese Problemdomain permanent speichern, nicht aber ersetzen.

\subsection{Architektur}
\label{sub:Architektur}

\subsubsection{Vorverarbeitung der Daten}
\label{architektur:Vorverarbeitung der Daten}
% hier pyosmosius beschreiben

TODO

\subsubsection{nächste ÖV-Haltestellen finden}
\label{architection:nächste ÖV-Haltestellen finden}

Das grundlegende Ziel ist es von einem Startpunkt aus, ein Destination zu Fuss und mit dem öffentlichen Verkehr zu erreichen. Dabei sollen die ÖV-Haltestellen in einem zu Fuss machbaren Umkreis berücksichtigt werden. Von diesen Haltestellen ausgehend wird das ÖV-Routing an die Zieldestination durchgeführt.

Für die Anforderung \ref{target:nächste ÖV-Haltestellen finden} bietet sich Overpass an. Overpass ermöglicht es über eine umfassende \acs{API} selektiv Daten von \acs{OSM} zu beziehen. Dabei besteht die Option die Overpass QL (query language) oder XML-Abfragen zu verwenden. Die Suche lässt sich nach allem einschränken, was der Mapper in den \acs{OSM}-Daten spezifizieren kann. So ist das Filtern nach Objekttyp, Keys, Tags, etc. unbeschränkt möglich und bietet so eine hohe Flexibilität. Overpass liefert die Resultate als JSON-Objekt oder XML. 

Für eine einfache Intergration in Python, gibt es Overpass Wrapper. Dabei wurden zwei Libraries berücksichtigt, namentlich overpass-api-python-wrapper und OverPy. Die Libraries haben einen ähnlich häufigen Updatezyklus. Für Beide wurde ein Proof of Concept implementiert, welcher die ÖV-Haltestellen im einem kleinen Umkreis vom Stadelhofen, Zürich, Schweiz abfragt.

Die Entscheidung fiel dabei auf OverPy. Ausschlaggebend war die ausführlichere Dokumentation und dass OverPy Klassen für Nodes, Relations, Way, Area, etc. und Hilfsfunktionen, welche das Ganze übersichtlich halten, anbietet. Bei overpass-api-python-wrapper besteht der Nachteil, dass das JSON-Resultat der Abfrage selber geparsed und verarbeitet werden muss.

\begin{listing}[ht]
    \inputminted{python}{projectdoc/listing/get_public_transport_stops_overpass.py}
    \caption{ÖV-Haltestellen von \acs{OSM} mit Overpass beziehen}
    \label{get_public_transport_stops_overpass}
\end{listing}

In Listing \ref{get_public_transport_stops_overpass} ist zu sehen, wie für eine Bounding Box, welche im Süden durch den minimalen Breitengrad, im Westen durch den minimalen Längengrad, im Norden durch den maximalen Breitengrad und im Osten durch den maximalen Längengrad begrenzt ist, die ÖV-Haltestellen abgefragt werden. Dabei wird die JSON-Response in Node-Objekte geparsed, welche weiterverwendet werden können. In diesem Beispiel wird für die Abfrage die erwähnte Overpass QL verwendet.

Es ist ebenfalls möglich eine Umkreissuche mit \textit{around} durchzuführen. Dies hat Performance-Nachteile und es gibt keine entscheidende Gründe, warum es vorteilhafter sein sollte, wenn man einen Kreis statt ein Rechteck um einen Ausgangspunkt zieht.

\subsection{Zusammenspiel Komponenten}
\label{sub:Zusammenspiel Komponenten}
%hier ein Sequenzdiagram wie die Komponente zusammenspielen, zum Beispiel Vorverarbeitung, dann in System spielen, dann Plugin, dann search.ch, dann Plugin, etc.
TODO

\subsection{Klassendiagramme}
\label{sub:Klassendiagramme}

TODO

\subsection{Sequenzdiagramme}
\label{sub:Sequenzdiagramme}

TODO

\subsection{UI Design}
\label{sub:UI Design}

TODO